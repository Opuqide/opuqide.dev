<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <h1>Opuqide — GitHub</h1>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <style>
    /* tiny styles */
    .repo { border:1px solid #ddd; padding:12px; margin:8px 0; border-radius:6px;}
  </style>
</head>
<body id="colorized" onload="main()">
  <header id="profile"></header>
  <section id="repos"></section>
  <section id="readme"></section>

<script>
const USER = 'Opuqide';

// 1) Fetch profile
async function fetchProfile() {
  const res = await fetch(`https://api.github.com/users/${USER}`);
  if (!res.ok) throw new Error('Profile load failed');
  return res.json();
}

// 2) Fetch repos (public)
async function fetchRepos() {
  const res = await fetch(`https://api.github.com/users/${USER}/repos?per_page=100&sort=updated`);
  if (!res.ok) throw new Error('Repos load failed');
  return res.json();
}

// 3) Fetch README for a repo, raw markdown (use Accept header)
async function fetchReadmeRaw(owner, repo) {
  const res = await fetch(`https://api.github.com/repos/${owner}/${repo}/readme`, {
    headers: { Accept: 'application/vnd.github.v3.raw' }
  });
  if (!res.ok) throw new Error('Readme load failed: ' + res.status);
  return res.text(); // markdown
}

async function init() {
  try {
    const profile = await fetchProfile();
    document.getElementById('profile').innerHTML = `
      <img src="${profile.avatar_url}" width="80" style="border-radius:50%"/>
      <h1>${profile.name || profile.login}</h1>
      <p>${profile.bio || ''}</p>
    `;

    const repos = await fetchRepos();
    const container = document.getElementById('repos');
    repos.slice(0, 12).forEach(r => {
      const el = document.createElement('div');
      el.className = 'repo';
      el.innerHTML = `
        <h3><a href="${r.html_url}" target="_blank" rel="noopener">${r.name}</a></h3>
        <p>${r.description || ''}</p>
        <small>★ ${r.stargazers_count} • Updated ${new Date(r.updated_at).toLocaleString()}</small>
        <div><button data-repo="${r.name}">Show README</button></div>
      `;
      container.appendChild(el);
    });

    // Delegate click to show README
    container.addEventListener('click', async (e) => {
      const btn = e.target.closest('button[data-repo]');
      if (!btn) return;
      const repo = btn.dataset.repo;
      btn.disabled = true;
      btn.textContent = 'Loading README…';
      try {
        const md = await fetchReadmeRaw(USER, repo);
        document.getElementById('readme').innerHTML = `<h2>${repo} — README</h2>${marked.parse(md)}`;
      } catch (err) {
        document.getElementById('readme').textContent = 'README not found or error';
      } finally {
        btn.disabled = false;
        btn.textContent = 'Show README';
      }
    });
  } catch (err) {
    console.error(err);
    document.body.insertAdjacentHTML('beforeend', '<p>Error loading GitHub data.</p>');
  }
}

init();
</script>
</body>
</html>